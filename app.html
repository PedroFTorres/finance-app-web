<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Finance App</title>

  <link rel="stylesheet" href="styles.css" />
</head>

<body>

  <!-- ========================= TOPO / MENU ========================= -->
  <header class="top-header">

    <nav class="top-menu">
      <!-- Navega√ß√£o moderna com data-target -->
      <button class="menu-btn" data-target="dashboard">Dashboard</button>
      <button class="menu-btn" data-target="contas">Contas</button>
      <button class="menu-btn" data-target="lanc">Lan√ßamentos</button>
      <button id="btn-transferir" class="btn-secondary">üîÅ Transferir</button>


      <!-- Mantido: bot√£o de cart√£o abre p√°gina externa -->
      <button class="menu-btn" onclick="window.location.href='cartao.html'">Cart√£o</button>
    </nav>

    <div class="top-bar">
      <span id="user-email" class="user-email"></span>
      <button id="btn-logout" class="danger">Sair</button>
    </div>
  </header>


  <!-- ========================= CONTE√öDO ========================= -->
  <main>

    <img src="logo-arolix.png" class="app-logo-center" alt="Arolix">

    <!-- ============================================================
         TELA DASHBOARD (data-screen)
    ============================================================ -->
    <section class="screen hidden" data-screen="dashboard">

      <section class="card-panel">
        <h2>Resumo do M√™s</h2>

        <div class="dashboard-grid">

          <div class="card">
            <h3>Receitas por Categoria</h3>
            <canvas id="chart-receitas-categorias"></canvas>
          </div>

          <div class="card">
            <h3>Despesas por Categoria</h3>
            <canvas id="chart-despesas-categorias"></canvas>
          </div>

          <div class="card">
            <h3>Resumo Geral</h3>
            <canvas id="chart-dashboard"></canvas>

            <p><strong>Per√≠odo:</strong> <span id="dash-period"></span></p>
            <p><strong>Total a receber:</strong> <span id="dash-receber">R$ 0,00</span></p>
            <p><strong>Total a pagar:</strong> <span id="dash-pagar">R$ 0,00</span></p>
            <p><strong>Saldo atual:</strong> <span id="dash-saldo-atual">R$ 0,00</span></p>
            <p><strong>Saldo previsto:</strong> <span id="dash-saldo-previsto">R$ 0,00</span></p>
          </div>

        </div>
      </section>

    </section>



    <!-- ============================================================ TELA CONTAs ============================================================ -->
    
    <section class="screen hidden" data-screen="contas">

      <div class="card-panel">
        <h2>Contas</h2>

        <div class="tabs">
          <button class="tab-btn active" data-tab="cadastro">Cadastro</button>
          <button class="tab-btn" data-tab="extrato">Extrato</button>
          <button class="tab-btn" data-tab="categorias">Categorias</button>

          <button id="btn-print-extrato" class="btn-secondary" style="margin-top:10px;">
            Imprimir / PDF
          </button>

          <script src="print.js"></script>
          <link rel="stylesheet" href="print.css">
        </div>


        <!-- TAB CADASTRO -->
        <div id="tab-cadastro">

          <label>Nome da conta</label>
          <input id="conta-nome" placeholder="Conta Ex: Nubank, Caixa..."/>

          <label>Saldo inicial</label>
          <input id="conta-saldo" type="number" placeholder="0.00"/>

          <label>Data do saldo</label>
          <input id="conta-data-saldo" type="date"/>

          <button id="btn-add-conta" class="btn-primary" style="margin-top:10px;">Adicionar Conta</button>

          <hr style="margin:25px 0"/>

          <label>Contas existentes</label>
          <select id="select-contas-lista"></select>

        </div>


        <!-- TAB EXTRATO -->
        <div id="tab-extrato" class="hidden">

          <h3>Extrato da Conta</h3>

          <label>Selecionar conta</label>
          <select id="select-contas-extrato"></select>

         <!-- ========================= EXTRATO ‚Äî FILTRO DE PER√çODO ========================== -->
          
<div class="filtro-periodo" style="display:flex;gap:14px;align-items:center;">

  <!-- Navega√ß√£o por m√™s -->
  <div class="mes-nav" style="display:flex;align-items:center;gap:8px;">
    <button id="extrato-prev" class="btn-secondary">‚óÄ</button>
    <strong id="extrato-mes-label"></strong>
    <button id="extrato-next" class="btn-secondary">‚ñ∂</button>
  </div>

  <!-- Abrir per√≠odo personalizado -->
  <button id="btn-extrato-periodo-custom" class="btn-secondary">
    Per√≠odo personalizado
  </button>

</div>

<!-- Per√≠odo personalizado -->
<div id="extrato-periodo-custom-box"
     class="hidden"
     style="margin-top:10px;display:flex;gap:10px;align-items:end;">

  <div>
    <label>De</label>
    <input type="date" id="extrato-inicio">
  </div>

  <div>
    <label>At√©</label>
    <input type="date" id="extrato-fim">
  </div>

  <button id="extrato-aplicar-periodo" class="btn-primary">
    Aplicar
  </button>

  <button id="extrato-cancelar-periodo" class="btn-secondary">
    Cancelar
  </button>

</div>

          <div class="table-wrap">
            <table id="table-extrato">
             <thead>
               <tr>
                 <th>Data</th>
                 <th>Descri√ß√£o</th>
                 <th>Tipo</th>
                 <th>Valor</th>
                 <th>Saldo</th>
               </tr>
             </thead>

              <tbody></tbody>
            </table>
          </div>

          <div class="extrato-totals">
            <p>Total Receitas: <span id="total-receitas-extrato">R$0,00</span></p>
            <p>Total Despesas: <span id="total-despesas-extrato">R$0,00</span></p>
            <p>Saldo do Per√≠odo: <span id="saldo-periodo-extrato">R$0,00</span></p>
            <p>Saldo atual da conta: <span id="saldo-atual-conta-extrato">R$0,00</span></p>
          </div>

        </div>


        <!-- TAB CATEGORIAS -->
        <div id="tab-categorias" class="hidden">

          <h3>Categorias</h3>

          <label>Nova categoria</label>
          <input id="categoria-nome" placeholder="Ex: Mercado, Transporte..."/>

          <button id="btn-add-categoria" class="btn-primary" style="margin-top:10px;">
            Adicionar Categoria
          </button>

          <hr style="margin:20px 0"/>

          <h4>Cadastradas</h4>
          <ul id="lista-categorias"></ul>

        </div>

      </div>

    </section>

<!-- ============================================================ TELA LAN√áAMENTOS  ============================================================ -->
<section class="screen hidden" data-screen="lanc">

  <div class="card-panel">
    <h2>Lan√ßamentos</h2>

    <!-- FILTROS - topo -->
   <!-- FILTRO DE PER√çODO (NOVO MODELO) -->
<div class="filtro-periodo" style="display:flex;gap:14px;align-items:center;">

  <!-- Navega√ß√£o por m√™s -->
  <div class="mes-nav" style="display:flex;align-items:center;gap:8px;">
    <button id="lanc-prev" class="btn-secondary">‚óÄ</button>
    <strong id="lanc-mes-label"></strong>
    <button id="lanc-next" class="btn-secondary">‚ñ∂</button>
  </div>

  <!-- Abrir per√≠odo personalizado -->
  <button id="btn-periodo-custom" class="btn-secondary">
    Per√≠odo personalizado
  </button>

</div>

<!-- Per√≠odo personalizado (oculto) -->
<div id="periodo-custom-box" class="hidden" style="margin-top:10px;display:flex;gap:10px;align-items:end;">

  <div>
    <label>De</label>
    <input type="date" id="lanc-inicio">
  </div>

  <div>
    <label>At√©</label>
    <input type="date" id="lanc-fim">
  </div>

  <button id="aplicar-periodo" class="btn-primary">
    Aplicar
  </button>

  <button id="cancelar-periodo" class="btn-secondary">
    Cancelar
  </button>

</div>

      <div style="display:flex;flex-direction:column;">
        <label>Conta</label>
        <select id="select-contas" style="min-width:200px;"></select>
      </div>

      <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
        <button id="btn-filtrar-lanc" class="btn-secondary">Filtrar</button>
        <button id="btn-open-add-lanc" class="btn-primary">Adicionar</button>
      </div>
    </div>
<!-- MENU + CONTE√öDO LATERAL -->
<div class="lanc-layout">

  <!-- MENU LATERAL -->
  <aside class="lanc-menu">
    <button data-lanc-tab="pendencias" class="active">Pend√™ncias</button>
    <button data-lanc-tab="receitas">Receitas</button>
    <button data-lanc-tab="despesas">Despesas</button>
    <button data-lanc-tab="recebidos">Recebidos</button>
    <button data-lanc-tab="pagos">Pagos</button>
  </aside>

  <!-- CONTE√öDO -->
  <div class="lanc-content">

    <div class="listas">

     <div class="box" id="box-receitas">
  <h3>Receitas</h3>
  <ul id="list-receitas"></ul>
</div>

<div class="box" id="box-despesas">
  <h3>Despesas</h3>
  <ul id="list-despesas"></ul>
</div>

    </div>

  </div>


    <!-- TOTAIS -->
    <div class="card-panel card-totais" style="margin-top:18px;">
      <h3>Totais do Per√≠odo</h3>

      <div class="total-item" style="display:flex;justify-content:space-between;padding:6px 0;">
        <strong>Total de receitas</strong>
        <span id="total-receitas" class="total-value">R$ 0,00</span>
      </div>

      <div class="total-item" style="display:flex;justify-content:space-between;padding:6px 0;">
        <strong>Total de despesas</strong>
        <span id="total-despesas" class="total-value">R$ 0,00</span>
      </div>

      <div class="total-item" style="display:flex;justify-content:space-between;padding:6px 0;">
        <strong>Saldo atual (filtro)</strong>
        <span id="saldo-atual" class="total-value">‚Äî</span>
      </div>
    </div>

  </div>

</section>

<!-- ========================= MODAL ADICIONAR LAN√áAMENTO (PROFISSIONAL) ========================= -->
    
<div id="modal-add-lanc" class="modal hidden" aria-hidden="true" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:1200;">
  <div class="modal-backdrop" style="position:absolute;inset:0;background:rgba(0,0,0,0.45);" onclick="document.getElementById('modal-add-lanc').classList.add('hidden')"></div>

  <div class="modal-card" role="dialog" aria-modal="true" style="position:relative;background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.25);width:720px;max-width:94%;padding:20px;z-index:1210;">
    <header style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <h3 style="margin:0">Adicionar Lan√ßamento</h3>
      <button id="btn-close-add-lanc" class="btn-icon" title="Fechar">‚úï</button>
    </header>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
      <div style="display:flex;flex-direction:column;">
        <label>Tipo</label>
        <select id="modal-tipo">
          <option value="receita">Receita</option>
          <option value="despesa">Despesa</option>
        </select>
      </div>

      <div style="display:flex;flex-direction:column;">
        <label>Valor</label>
        <input id="modal-valor" type="number" step="0.01" placeholder="0.00"/>
      </div>

      <div style="grid-column:1 / -1;display:flex;flex-direction:column;">
        <label>Descri√ß√£o</label>
        <input id="modal-desc" placeholder="Ex: Venda, Compra supermercado..." />
      </div>

      <div>
        <label>Data</label>
        <input id="modal-data" type="date" />
      </div>

      <div>
        <label>Conta</label>
        <select id="modal-conta"></select>
      </div>

      <div>
        <label>Categoria</label>
        <select id="modal-categoria"></select>
      </div>

      <div style="display:flex;flex-direction:column;">
        <label>Recorr√™ncia</label>
        <select id="modal-recorrencia">
          <option value="none">N√£o recorrente</option>
          <option value="monthly">Mensal</option>
          <option value="fortnight">Quinzenal</option>
          <option value="weekly">Semanal</option>
          <option value="annual">Anual</option>
        </select>
      </div>

      <div style="display:flex;flex-direction:column;">
        <label>Parcelas</label>
        <input id="modal-parcelas" type="number" min="1" value="1" />
      </div>
    </div>
      <!-- AVISO: LAN√áAMENTO J√Å BAIXADO -->
    <div id="aviso-baixado" class="alert-warning hidden" style="margin-top:14px;">
      <strong>‚ö†Ô∏è Lan√ßamento j√° baixado</strong><br>
      Altera√ß√µes feitas aqui ser√£o refletidas automaticamente no extrato da conta.
    </div>

    <footer style="display:flex;justify-content:flex-end;gap:8px;margin-top:18px;">
      <button id="modal-cancel-lanc" class="btn-secondary">Cancelar</button>
      <button id="modal-save-lanc" class="btn-primary">Salvar</button>
    </footer>
  </div>
</div>
 
   
 <!-- ========================= MODAL DE BAIXA ========================= -->
<div id="modal-baixa" class="modal hidden" aria-hidden="true"
     style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:1200;">

  <div class="modal-backdrop"
       style="position:absolute;inset:0;background:rgba(0,0,0,0.45);"
       onclick="document.getElementById('modal-baixa').classList.add('hidden')">
  </div>

  <div class="modal-card"
       role="dialog"
       aria-modal="true"
       style="position:relative;background:#fff;border-radius:12px;
              box-shadow:0 10px 30px rgba(0,0,0,0.25);
              width:420px;max-width:95%;padding:20px;z-index:1210;">

    <h3>Baixar Lan√ßamento</h3>

    <label>Data da baixa</label>
    <input type="date" id="data-baixa">

    <label>Juros / Multa (opcional)</label>
    <input type="number" id="juros-baixa" step="0.01">

    <label>Desconto / Abatimento (opcional)</label>
    <input type="number" id="desconto-baixa" step="0.01">

    <label>Conta para baixar</label>
    <select id="conta-baixa-select"></select>

    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
      <button id="confirmar-baixa" class="btn-primary">Confirmar</button>
      <button id="cancelar-baixa" class="btn-danger"
              onclick="document.getElementById('modal-baixa').classList.add('hidden')">
        Cancelar
      </button>
    </div>

  </div>
</div>

<!-- ========================= MODAL TRANSFER√äNCIA ========================= -->
    
<div id="modal-transferencia" class="modal hidden">
  <div class="modal-content" style="max-width:420px;">
    <h3>Transferir entre contas</h3>

    <label>Conta origem</label>
    <select id="transf-origem"></select>

    <label>Conta destino</label>
    <select id="transf-destino"></select>

    <label>Valor</label>
    <input type="number" id="transf-valor" step="0.01">

    <label>Data</label>
    <input type="date" id="transf-data">

    <label>Descri√ß√£o</label>
    <input type="text" id="transf-desc" placeholder="Ex: Reserva, investimento...">

    <div class="actions-row" style="margin-top:15px;">
      <button id="btn-confirmar-transf" class="btn-primary">Confirmar</button>
      <button onclick="document.getElementById('modal-transferencia').classList.add('hidden')" class="btn-secondary">
        Cancelar
      </button>
    </div>
  </div>
</div>

  <!-- ========================= SCRIPTS ========================= -->

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="supabase.js"></script>
  <script src="app.js"></script>
    
  <!-- MODAL ‚Äî Escopo de edi√ß√£o de recorr√™ncia -->
<div id="modal-escopo-recorrencia" class="modal hidden">
  <div class="modal-content" style="max-width:420px;">
    <h3>Editar lan√ßamento recorrente</h3>
    <p>Este lan√ßamento faz parte de uma recorr√™ncia. O que deseja editar?</p>

    <label style="display:block;margin-top:10px;">
      <input type="radio" name="escopo-rec" value="one" checked>
      Apenas este lan√ßamento
    </label>

    <label style="display:block;margin-top:6px;">
      <input type="radio" name="escopo-rec" value="next">
      Este e os pr√≥ximos
    </label>

    <label style="display:block;margin-top:6px;">
      <input type="radio" name="escopo-rec" value="all">
      Todos da recorr√™ncia
    </label>

    <div class="actions-row" style="margin-top:16px;">
      <button id="btn-confirmar-escopo" class="btn-primary">Continuar</button>
      <button id="btn-cancelar-escopo" class="btn-secondary">Cancelar</button>
    </div>
  </div>
</div>
    
    <!-- MODAL ‚Äî Escopo de exclus√£o de recorr√™ncia -->
<div id="modal-excluir-recorrencia" class="modal hidden">
  <div class="modal-content" style="max-width:420px;">
    <h3>Excluir lan√ßamento recorrente</h3>
    <p>Este lan√ßamento faz parte de uma recorr√™ncia. O que deseja excluir?</p>

    <label>
      <input type="radio" name="escopo-del" value="one" checked>
      Apenas este lan√ßamento
    </label><br>

    <label>
      <input type="radio" name="escopo-del" value="next">
      Este e os pr√≥ximos
    </label><br>

    <label>
      <input type="radio" name="escopo-del" value="all">
      Todos da recorr√™ncia
    </label>

    <div class="actions-row" style="margin-top:16px;">
      <button id="btn-confirmar-del" class="btn-danger">Excluir</button>
      <button id="btn-cancelar-del" class="btn-secondary">Cancelar</button>
    </div>
  </div>
</div>
    
<!-- =========================MODAL LOADING (PROCESSANDO)========================= -->
    
<div id="modal-loading" class="modal hidden">
  <div class="modal-content" style="text-align:center">
    <div class="spinner"></div>
    <p style="margin-top:12px;font-weight:600">
      Processando lan√ßamentos‚Ä¶
    </p>
  </div>
</div>

    
</body>
</html>
