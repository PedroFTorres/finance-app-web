<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Finance App</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- ESTILO DO MODAL DE BAIXA -->
  <style>
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal.hidden { display: none; }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 12px;
      width: 90%;
      max-width: 420px;
    }
    .modal-content h3 { margin-top: 0; }
    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      margin-bottom: 10px;
    }
    .modal-actions {
      display: flex;
      justify-content: space-between;
      gap: 10px;
    }
    .modal-actions button {
      flex: 1;
      padding: 10px;
      font-weight: bold;
      cursor: pointer;
    }
  </style>

</head>

<body>

  <!-- TOPO -->
  <header class="top-header">
    <nav class="top-menu">
      <button id="menu-dashboard" class="menu-btn">Dashboard</button>
      <button id="menu-contas" class="menu-btn active">Contas</button>
      <button id="menu-lancamentos" class="menu-btn">Lançamentos</button>
      <button id="menu-cartao" class="menu-btn" onclick="window.location.href='cartao.html'">Cartão</button>
    </nav>

    <div class="top-bar">
      <span id="user-email" class="user-email"></span>
      <button id="btn-logout" class="danger">Sair</button>
    </div>
  </header>

  <main>
    <h1>Finance App</h1>

    <!-- DASHBOARD -->
    <section id="tela-dashboard" class="hidden">

      <section class="dashboard-box">
        <h2>Resumo do Mês</h2>

        <div class="dashboard-grid">

          <div class="card">
            <h3>Receitas por Categoria</h3>
            <canvas id="chart-receitas-categorias"></canvas>
          </div>

          <div class="card">
            <h3>Despesas por Categoria</h3>
            <canvas id="chart-despesas-categorias"></canvas>
          </div>

          <div class="card">
            <h3>Resumo Geral</h3>
            <canvas id="chart-dashboard"></canvas>
            <p><strong>Período:</strong> <span id="dash-period"></span></p>
            <p><strong>Total a receber:</strong> <span id="dash-receber">R$ 0,00</span></p>
            <p><strong>Total a pagar:</strong> <span id="dash-pagar">R$ 0,00</span></p>
            <p><strong>Saldo atual:</strong> <span id="dash-saldo-atual">R$ 0,00</span></p>
            <p><strong>Saldo previsto:</strong> <span id="dash-saldo-previsto">R$ 0,00</span></p>
          </div>

        </div>
      </section>
    </section>

    <!-- CONTAS -->
    <section id="tela-contas">

      <section class="contas-box">
        <h2>Contas</h2>

        <div class="tabs">
          <button class="tab-btn active" data-tab="cadastro">Cadastro</button>
          <button class="tab-btn" data-tab="extrato">Extrato</button>
          <button class="tab-btn" data-tab="categorias">Categorias</button>
        </div>

        <!-- TAB CADASTRO -->
        <div id="tab-cadastro" class="tab-content">
          <label>Nome da conta</label><br/>
          <input id="conta-nome" placeholder="Nova conta" />

          <label>Saldo inicial</label><br/>
          <input id="conta-saldo" type="number" placeholder="Saldo inicial"/>

          <label>Data do saldo</label><br/>
          <input id="conta-data-saldo" type="date" />

          <button id="btn-add-conta">Adicionar Conta</button>

          <hr/>

          <label>Contas existentes</label><br/>
          <select id="select-contas"></select>
        </div>

        <!-- TAB EXTRATO -->
        <div id="tab-extrato" class="tab-content hidden">

          <h3>Extrato da Conta</h3>

          <label>Selecionar conta</label><br/>
          <select id="select-contas-extrato"></select>

          <div class="filtros">
            <label>Período</label>
            <select id="periodo-extrato">
              <option value="mes_atual">Mês atual</option>
              <option value="mes_anterior">Mês anterior</option>
              <option value="ultimos_30">Últimos 30 dias</option>
              <option value="personalizado">Personalizado</option>
            </select>

            <input type="date" id="data-inicio" class="hidden"/>
            <input type="date" id="data-fim" class="hidden"/>

            <button id="btn-filtrar-extrato">Filtrar</button>
          </div>

          <div class="table-wrap">
            <table id="table-extrato">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Descrição</th>
                  <th>Tipo</th>
                  <th>Valor</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr>
                  <td colspan="3"><strong>Totais</strong></td>
                  <td id="total-valor"><strong>R$ 0,00</strong></td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="extrato-totals">
            <p>Total Receitas: <span id="total-receitas-extrato">R$0,00</span></p>
            <p>Total Despesas: <span id="total-despesas-extrato">R$0,00</span></p>
            <p>Saldo do Período: <span id="saldo-periodo-extrato">R$0,00</span></p>
            <p>Saldo atual da conta: <span id="saldo-atual-conta-extrato">R$0,00</span></p>
          </div>

        </div>

        <!-- TAB CATEGORIAS -->
        <div id="tab-categorias" class="tab-content hidden">
          <h3>Categorias</h3>

          <label>Nova categoria</label><br/>
          <input id="categoria-nome" placeholder="Ex: Mercado, Salário, Transporte"/>

          <button id="btn-add-categoria">Adicionar Categoria</button>

          <hr/>

          <h4>Categorias cadastradas</h4>
          <ul id="lista-categorias"></ul>
        </div>

      </section>
    </section>

    <!-- LANÇAMENTOS -->
    <section id="tela-lancamentos" class="hidden">

      <section class="lancamento-box">
        <h2>Lançamento</h2>

        <div class="filtros-lanc">
          <label>Período</label>
          <select id="periodo-lanc">
            <option value="mes_atual">Mês atual</option>
            <option value="mes_anterior">Mês anterior</option>
            <option value="ultimos_30">Últimos 30 dias</option>
            <option value="personalizado">Personalizado</option>
          </select>

          <input type="date" id="data-inicio-lanc" class="hidden"/>
          <input type="date" id="data-fim-lanc" class="hidden"/>

          <button id="btn-filtrar-lanc">Filtrar</button>
        </div>

        <select id="tipo-lancamento">
          <option value="receita">Receita</option>
          <option value="despesa">Despesa</option>
        </select>

        <input id="valor-lanc" type="number" placeholder="Valor" />
        <input id="desc-lanc" placeholder="Descrição" />
        <input id="data-lanc" type="date" />

        <label>Conta</label>
        <select id="select-conta-lanc"></select>

        <label>Categoria</label>
        <select id="categoria-lanc"></select>

        <div class="recorrencia">
          <label>Recorrência</label>
          <select id="recorrencia-tipo">
            <option value="none">Não recorrente</option>
            <option value="monthly">Mensal</option>
            <option value="fortnight">Quinzenal</option>
            <option value="weekly">Semanal</option>
            <option value="annual">Anual</option>
          </select>

          <label>Parcelas</label>
          <input id="recorrencia-parcelas" type="number" min="1" value="1" />
        </div>

        <button id="btn-add-lanc">Adicionar</button>
        <button id="btn-cancel-edit" class="hidden">Cancelar</button>

        <div class="totais">
          <span id="saldo-atual"></span>
          <span id="total-receitas"></span>
          <span id="total-despesas"></span>
        </div>

      </section>

      <section class="listas">
        <div class="box">
          <h3>Receitas</h3>
          <ul id="list-receitas"></ul>
        </div>

        <div class="box">
          <h3>Despesas</h3>
          <ul id="list-despesas"></ul>
        </div>
      </section>

    </section>

  </main>


  <!-- ======================= MODAL DE BAIXA ======================= -->

  <div id="modal-baixa" class="modal hidden">
    <div class="modal-content">
      <h3>Baixar Lançamento</h3>

      <label>Data da baixa</label>
      <input type="date" id="data-baixa">

      <label>Juros / Multa (opcional)</label>
      <input type="number" step="0.01" id="juros-baixa">

      <label>Desconto / Abatimento (opcional)</label>
      <input type="number" step="0.01" id="desconto-baixa">

      <label>Conta para baixar</label>
      <select id="conta-baixa-select"></select>

      <div class="modal-actions">
        <button id="confirmar-baixa" class="primary">Confirmar</button>
        <button id="cancelar-baixa" class="danger">Cancelar</button>
      </div>
    </div>
  </div>



  <!-- SCRIPTS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="supabase.js"></script>
  <script src="app.js"></script>

</body>
</html>
